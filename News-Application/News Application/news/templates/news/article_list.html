{% extends 'news/base.html' %}

{% block title %}Articles - News Application{% endblock %}

{% block content %}
<h1>Articles</h1>

{% if user_role == 'journalist' %}
    <p><a href="{% url 'news:create_article' %}" class="btn btn-primary">Create New Article</a></p>
{% endif %}

{% if page_obj %}
    {% for article in page_obj %}
        <div class="article-card">
            <h2 class="article-title">
                <a href="{% url 'news:article_detail' article.pk %}">{{ article.title }}</a>
            </h2>
            <div class="article-meta">
                By {{ article.author.username }} 
                {% if article.publisher %} | {{ article.publisher.name }}{% endif %}
                {% if article.category %} | {{ article.category.name }}{% endif %}
                | {{ article.created_at|date:"M d, Y" }}
                | Status: <span class="status-{{ article.status }}">{{ article.get_status_display }}</span>
                {% if article.is_approved %}
                    | <span class="status-approved">âœ“ Approved</span>
                {% endif %}
            </div>
            {% if article.summary %}
                <p>{{ article.summary }}</p>
            {% endif %}
            
            {% if user.is_authenticated %}
                {% if user == article.author or user.is_editor %}
                    <div class="article-actions">
                        <a href="{% url 'news:edit_article' article.pk %}" class="btn btn-secondary">Edit</a>
                    </div>
                {% endif %}
                
                {% if user.is_editor and not article.is_approved %}
                    <div class="article-actions">
                        <a href="{% url 'news:approve_article' article.pk %}" class="btn btn-primary">Review & Approve</a>
                    </div>
                {% endif %}
            {% endif %}
        </div>
    {% endfor %}

    {% if page_obj.has_other_pages %}
        <div class="pagination">
            {% if page_obj.has_previous %}
                <a href="?page=1">&laquo; First</a>
                <a href="?page={{ page_obj.previous_page_number }}">Previous</a>
            {% endif %}

            <span class="current">
                Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}
            </span>

            {% if page_obj.has_next %}
                <a href="?page={{ page_obj.next_page_number }}">Next</a>
                <a href="?page={{ page_obj.paginator.num_pages }}">Last &raquo;</a>
            {% endif %}
        </div>
    {% endif %}
{% else %}
    <p>No articles found.</p>
{% endif %}

<a href="{% url 'news:home' %}" class="btn btn-secondary">Back to Home</a>
{% endblock %}
